<div class="row" style="margin-top: -7px; margin-bottom: 0;">
  <div class="card-panel">
    <div class="search-offers">
      <%= form_tag tintas_path, method: :get do %>
        <fieldset style="border: none; margin: 0; padding: 0;">
          <div class="row" style="margin-bottom: 0;">
            <div class="input-field col s12 m3">
              <%= select_tag :marca, options_for_select([ "Resicolor" ], "Resicolor") %>
            </div>
            <div class="input-field col s12 m5">
              <%= text_field_tag :color, params[:color], class: "autocomplete" %>
              <%= label_tag :color, "Cor" %>
            </div>
            <div class="input-field col s12 m4">
              <%= select_tag :can, options_for_select({"Lata" => "LATA", "Galão" => "GALAO", "Quarto" => "QUARTO"}, params[:can]) %>
            </div>
          </div>
          <div class="row">
            <div class="input-field col s12 m3">
              <%= select_tag(:line, options_from_collection_for_select(Rline.all, :id, :name, params[:line]), include_blank: true, prompt: "Linha") %>
            </div>

            <div class="input-field col s12 m3">
              <%= select_tag(:rp, options_for_select(Rproduct.all.map(&:code).uniq, params[:rp]), include_blank: true, prompt: "Cobertura") %>
            </div>
          </div>

          <button class="btn" type="submit" name="action">
            Buscar
          </button>
        </fieldset>
      <% end %>
    </div>
  </div>
</div>

<% if @tintas %>
<% @tintas.first(50).each do |tinta| %>
<div id="rf-<%= tinta.id %>" class="modal">
  <div class="modal-content">
    <h5 style="text-align: center;"><%= tinta.color.split("-").first.humanize %> (<%= params[:can] %>)</h5>
    <h6 style="text-align: center;"><%= "#{tinta.rline.name} - #{tinta.rproduct.code}" %></h5>
    <table class="striped bordered">
      <thead>
        <tr>
            <th data-field="">Corante</th>
            <th data-field=""></th>
            <th data-field="">Quantidade</th>
        </tr>
      </thead>

      <tbody>
        <% (1..6).each do |n| %>
          <% base = tinta.get_base(n) %>
          <% if base %>
            <tr>
              <td><%= base.try(:code) %></td>
              <td><%= base.try(:name) %></td>
              <td><%= tinta.send("q#{n}") %></td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </div>
  <div class="modal-footer">
    <!-- <div style="background-color: #<%= tinta.rgb %>;
                width: 80px; height: 40px;
                border: 1px solid #dedede;
                bottom: 20px; left: 20px; position: absolute;"><%#= tinta.rgb %></div> !-->

    <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Fechar</a>
  </div>
</div>
<% end %>
<% end %>

<div class="card-panel" style="margin-top: -14px;">
  <table class="bordered">
    <thead>
      <tr style="background-color: #efefef; border: 1px solid #dedede;">
          <th data-field="name">Cor</th>
          <th data-field="name">Linha</th>
          <th data-field="name">Cobertura</th>
          <th data-field="name">Preço</th>
          <th data-field="actions"></th>
      </tr>
    </thead>

    <tbody>
      <% if @tintas %>
        <% @tintas.first(30).each do |tinta| %>
        <tr>
          <td><%= tinta.rcolor.name.split("-").first %></td>
          <td><%= tinta.rline.name %></td>
          <td><%= tinta.rproduct.code %></td>
          <td><%= number_to_currency tinta.calculate_price(params[:can]) %></td>
          <td>
            <%= link_to "Fórmula", "#rf-#{tinta.id}", class: "modal-trigger" %> |
            <%= link_to "Adicionar", order_tintas_path(tinta_id: tinta.id, quantity: 1, can: params[:can]), method: :post, remote: true %>
          </td>
        </tr>

        <% end %>
      <% end %>
    </tbody>
  </table>
</div>
<script>
